---
## Author
author:
  name: Жукова Арина Александровна
  degrees: 3rd year student
  orcid: 0000-0002-0877-7063
  email: 1132239120@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа №2"
subtitle: "НастройкаDNS-сервера"
license: "CC BY"
---


# Цель работы

Приобретение практических навыков по установке и конфигурированию DNS сервера, усвоение принциповработысистемыдоменныхимён.

# Задание

1. Установитенавиртуальноймашинеserver DNS-серверbind иbind-utils.
2. Сконфигурируйте на виртуальной машине server кэширующий DNS-сервер .
3. Сконфигурируйтенавиртуальноймашинеserver первичныйDNS-сервер.
4. При помощи утилит dig и host проанализируйте работу DNS-сервера.
5. Напишите скрипт для Vagrant, фиксирующий действия по установке и конфигурированию DNS-сервера во внутреннем окружении виртуальной машины server. Соответствующим образом внесите изменения в Vagrantfile.

# Теоретическое введение

**DNS (Domain Name System)** — это распределённая система, которая преобразует доменные имена (например, `www.example.com`) в IP-адреса (например, `192.168.1.1`) и наоборот. Она обеспечивает работу интернета, позволяя пользователям обращаться к ресурсам по удобным именам, а не по числовым адресам.

**Основные компоненты DNS:**

1. **DNS-сервер** — программа, хранящая информацию о доменных зонах и обрабатывающая запросы. Наиболее популярным решением является BIND (Berkeley Internet Name Domain).
2. **DNS-клиент** — программа или библиотека, отправляющая запросы к DNS-серверам.
3. **Доменная зона** — часть доменного пространства, управляемая администратором. Зоны делятся на:
   - **Прямые зоны** — сопоставляют имена с IP-адресами.
   - **Обратные зоны** — сопоставляют IP-адреса с именами (например, через домен `in-addr.arpa`).

**Типы DNS-серверов:**
- **Primary Master** — основной сервер, загружающий данные зоны из локальных файлов.
- **Secondary Master** — резервный сервер, получающий данные зоны от основного.
- **Кэширующий** — сервер, обрабатывающий запросы клиентов и кэширующий ответы для ускорения работы.

**Основные типы DNS-записей (RR — Resource Records):**
- **SOA** — информация о зоне и её администраторе.
- **NS** — указание на серверы имён для зоны.
- **A** — сопоставление имени с IPv4-адресом.
- **PTR** — обратное сопоставление IP-адреса с именем.
- **CNAME** — создание псевдонимов для имён.
- **MX** — указание почтовых серверов для домена.

**Утилиты диагностики:**
- **dig** — мощная утилита для выполнения DNS-запросов и анализа ответов.
- **host** — простая утилита для разрешения имён и проверки зон.

DNS играет ключевую роль в обеспечении стабильности и безопасности интернета, а её настройка требует понимания принципов работы зон, типов записей и взаимодействия между серверами.

# Выполнение лабораторной работы

## Установка DNS-сервера

1.  На виртуальной машине server войдите под созданным вами в предыдущей работе пользователем и откройте терминал. Перейдите в режим суперпользователя ([рис. @fig-001]).

![Вход в режим суперпользователя](image/1.png){#fig-001 width=70%}

2. Установите bind и bind-utils ([рис. @fig-003]).

![Установка](image/3.png){#fig-003 width=70%}

3. В качестве упражнения с помощью утилиты dig сделайте запрос к DNS-адресу www.yandex.ru ([рис. @fig-002]).

![запрос к DNS-адресу ](image/2.png){#fig-002 width=70%}

## Конфигурирование кэширующего DNS-сервера

### Конфигурирование кэширующего DNS-сервера при отсутствии фильтрации DNS-запросов маршрутизаторами

1. Анализ файлов 

![/etc/resolv.conf](image/4.png){#fig-0111 width=70%}



![/etc/named.conf](image/5.png){#fig-0112 width=70%}



![/var/named/named.ca](image/6.png){#fig-0113 width=70%}

![/var/named/named.ca2](image/61.png){#fig-01131 width=70%}

![/var/named/named.ca3](image/62.png){#fig-01132 width=70%}

![/var/named/named.ca4](image/63.png){#fig-01133 width=70%}

![/var/named/named.ca5](image/64.png){#fig-01134 width=70%}



![/var/named/named.localhost](image/7.png){#fig-0114 width=70%}



![/var/named/named.loopback](image/8.png){#fig-0115 width=70%}



2. Запустите DNS-сервер, Включите запуск DNS-сервера в автозапуск при загрузке системы ([рис. @fig-012]).

![запуск DNS-сервера](image/9.png){#fig-012 width=70%}

3. Анализ различий 

![dig www.yandex.ru](image/10.png){#fig-013 width=70%}



![dig @127.0.0.1 www.yandex.ru](image/11.png){#fig-0131 width=70%}



4. Сделайте DNS-сервер сервером по умолчанию для хоста server и внутренней виртуальной сети. Для этого требуется изменить настройки сетевого соединения eth0 в NetworkManager, переключив его на работу с внутренней сетью и указав для него в качестве DNS-сервера по умолчанию адрес 127.0.0.1. Сделайте тоже самое для соединения System eth0 (если оно активно). Перезапустите NetworkManager ([рис. @fig-014]).

![DNS-сервер сервер по умолчанию](image/12.png){#fig-014 width=70%}

5. Требуется настроить направление DNS-запросов от всех узлов внутренней сети, включая запросы от узла server, через узел server. Для этого внесите изменения в файл /etc/named.conf([рис. @fig-015]).

![направление DNS-запросов от всех узлов внутренней сети](image/13.png){#fig-015 width=70%}

6. Внесите изменения в настройки межсетевого экрана узла server, разрешив работу с DNS([рис. @fig-016]).

![настройки межсетевого экрана узла server](image/14.png){#fig-016 width=70%}

7. Убедитесь, что DNS-запросы идут через узел server, который прослушивает порт 53. Для этого на данном этапе используйте команду lsof([рис. @fig-0017]).

![команда lsof](image/15.png){#fig-0017 width=70%}

## Конфигурирование первичного DNS-сервера

1. Скопируйте шаблон описания DNS-зон named.rfc1912.zones из каталога /etc в каталог /etc/named и переименуйте его в aazhukova.net ([рис. @fig-021]).

![копирование шаблона описания DNS-зон ](image/16.png){#fig-021 width=70%}

2. Включите файл описания зоны /etc/named/user.net в конфигурационном файле DNS /etc/named.conf([рис. @fig-022]).

![/etc/named.conf](image/17.png){#fig-022 width=70%}

3. Откройте файл /etc/named/user.net на редактирование и пропишите свою прямую зону, пропишите свою обратную зону([рис. @fig-023]).

![/etc/named/aazhukova.net](image/18.png){#fig-023 width=70%}

4. В каталоге /var/named создайте подкаталоги master/fz и master/rz, в которых будут располагаться файлы прямой и обратной зоны соответственно([рис. @fig-024]).

![каталог /var/named](image/19.png){#fig-024 width=70%}

5. Измените файл /var/named/master/fz/user.net, указав необходимые DNS-записи для прямой зоны([рис. @fig-00]).

![/var/named/master/fz/aazhukova.net](image/20.png){#fig-020 width=70%}

6. Измените файл /var/named/master/rz/192.168.1, указав необходимые DNS-записи
для обратной зоны ([рис. @fig-025]).

![/var/named/master/rz/192.168.1](image/21.png){#fig-025 width=70%}

7. Далее требуется исправить права доступа к файлам в каталогах /etc/named и /var/named, чтобы демон named мог с ними работать. . В системах с запущенным SELinux все процессы и файлы имеют специальные метки безопасности (так называемый «контекст безопасности»), используемые системой для принятия решений по доступу к этим процессам и файлам. После изменения доступа к конфигурационным файлам named требуется корректно восстановить их метки в SELinux. Для проверки состояния переключателей SELinux, относящихся к named ([рис. @fig-026]).

![Cостояния переключателей SELinux](image/23.png){#fig-026 width=70%}

8. В дополнительном терминале запустите в режиме реального времени расширенный лог системных сообщений, чтобы проверить корректность работы системы и в первом терминале перезапустите DNS-сервер ([рис. @fig-027]).

![перезапуск DNS-сервер ](image/25.png){#fig-027 width=70%}

## Анализ работы DNS-сервера

1. При помощи утилиты dig получите описание DNS-зоны с сервера ns.user.net ([рис. @fig-031]).

![описание DNS-зоны с сервера](image/26.png){#fig-031 width=70%}

2. При помощи утилиты host проанализируйте корректность работы DNS-сервера ([рис. @fig-032]).

![утилиты host](image/271.png){#fig-032 width=70%}

![утилиты host](image/272.png){#fig-033 width=70%}

##  Внесение изменений в настройки внутреннего окружения виртуальной машины

1. На виртуальной машине server перейдите в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создайте в нём каталог dns, в который поместите в соответствующие каталоги конфигурационные файлы DNS ([рис. @fig-041]).

![/vagrant/provision/server/](image/29.png){#fig-041 width=70%}


2. . В каталоге /vagrant/provision/server создайте исполняемый файл dns.sh ([рис. @fig-042]).

![файл dns.sh](image/30.png){#fig-042 width=70%}


3. Для отработки созданного скрипта во время загрузки виртуальной машины server в конфигурационном файле Vagrantfile необходимо добавить в разделе конфигурации для сервера([рис. @fig-043]).

![Vagrantfile](image/31.png){#fig-043 width=70%}

# Выводы

Я приобрела практические навыки по установке и конфигурированию DNSсервера, усвоила принципов работы системы доменных имён.

# Ответы на контрольные вопросы

1.  **Что такое DNS?**
    DNS (Domain Name System) — это распределённая система (распределённая база данных), которая преобразует доменные имена хостов в IP-адреса и наоборот.

2.  **Каково назначение кэширующего DNS-сервера?**
    Назначение кэширующего DNS-сервера — принимать рекурсивные запросы от клиентов и выполнять их с помощью нерекурсивных запросов к авторитетным серверам, кэшируя результаты для ускорения последующих аналогичных запросов.

3.  **Чем отличается прямая DNS-зона от обратной?**
    *   **Прямая зона** сопоставляет доменное имя с IP-адресом (записи A, AAAA).
    *   **Обратная зона** сопоставляет IP-адрес с доменным именем (записи PTR) и используется в специальном домене `in-addr.arpa`.

4.  **В каких каталогах и файлах располагаются настройки DNS-сервера? Кратко охарактеризуйте, за что они отвечают.**
    *   `/etc/named.conf` — главный конфигурационный файл DNS-сервера BIND, определяет основные параметры, зоны и правила доступа.
    *   `/etc/named/` — каталог для дополнительных конфигурационных файлов зон (например, `/etc/named/user.net`).
    *   `/var/named/` — каталог для файлов данных зон (прямых и обратных).
    *   `/var/named/named.ca` — файл с корневыми серверами DNS.
    *   `/var/named/named.localhost`, `/var/named/named.loopback` — шаблоны для создания файлов зон.

5.  **Что указывается в файле resolv.conf?**
    В файле `/etc/resolv.conf` указываются IP-адреса DNS-серверов, которые использует система для разрешения доменных имён.

6.  **Какие типы записи описания ресурсов есть в DNS и для чего они используются?**
    *   **SOA** (Start of Authority) — указывает на авторитетность сервера для зоны и содержит управляющие параметры.
    *   **NS** (Name Server) — указывает на DNS-серверы, обслуживающие домен.
    *   **A** (Address) — сопоставляет имя хоста с IPv4-адресом.
    *   **PTR** (Pointer) — сопоставляет IP-адрес с доменным именем (для обратных зон).
    *   **CNAME** (Canonical Name) — задаёт каноническое имя (псевдоним) для хоста.
    *   **MX** (Mail Exchanger) — указывает почтовые серверы для домена.

7.  **Для чего используется домен in-addr.arpa?**
    Домен `in-addr.arpa` используется для организации обратного просмотра DNS (reverse DNS lookup), то есть для сопоставления IP-адресов с доменными именами.

8.  **Для чего нужен демон named?**
    Демон `named` — это сервис DNS-сервера BIND (Berkeley Internet Name Domain), который отвечает на DNS-запросы и управляет зонами.

9.  **В чём заключаются основные функции slave-сервера и master-сервера?**
    *   **Master-сервер** (primary) — хранит основную (авторитетную) копию данных зоны и загружает их из файла на диске.
    *   **Slave-сервер** (secondary) — получает данные зоны от master-сервера через механизм зонных трансферов, обеспечивая избыточность и надежность.

10. **Какие параметры отвечают за время обновления зоны?**
    В SOA-записи:
    *   `refresh` — интервал, через который slave-сервер проверяет актуальность зоны у master.
    *   `retry` — интервал повторной попытки связи с master после сбоя.
    *   `expire` — время, после которого данные зоны на slave считаются устаревшими, если нет связи с master.
    *   `minimum` — время негативного кэширования.

11. **Как обеспечить защиту зоны от скачивания и просмотра?**
    Защита обеспечивается настройками контроля доступа в `named.conf` (директивы `allow-query`, `allow-transfer`), использованием TSIG-ключей для авторизации трансферов и настройкой брандмауэра.

12. **Какая запись RR применяется при создании почтовых серверов?**
    Для почтовых серверов применяется запись типа **MX** (Mail Exchanger).

13. **Как протестировать работу сервера доменных имён?**
    Работу DNS-сервера тестируют с помощью утилит `dig` и `host`, отправляя запросы разных типов (A, PTR, MX, NS) и проверяя корректность и полноту ответов.

14. **Как запустить, перезапустить или остановить какую-либо службу в системе?**
    Используются команды `systemctl`:
    *   `systemctl start <service_name>`
    *   `systemctl restart <service_name>`
    *   `systemctl stop <service_name>`

15. **Как посмотреть отладочную информацию при запуске какого-либо сервиса или службы?**
    Отладочную информацию можно посмотреть с помощью команды `journalctl -u <service_name>` или в реальном времени с помощью `journalctl -x -f` при перезапуске службы.

16. **Где храниться отладочная информация по работе системы и служб? Как её посмотреть?**
    Отладочная информация хранится в журналах systemd (journald). Просмотреть её можно с помощью утилиты `journalctl`.

17. **Как посмотреть, какие файлы использует в своей работе тот или иной процесс? Приведите несколько примеров.**
    Для этого используется утилита `lsof`. Примеры:
    *   `lsof -p <PID>` — показать файлы, используемые процессом с указанным ID.
    *   `lsof | grep UDP` — найти процессы, использующие UDP-сокеты (например, DNS-сервер на порту 53).

18. **Приведите несколько примеров по изменению сетевого соединения при помощи командного интерфейса nmcli.**
    *   `nmcli connection edit "eth0"` — войти в интерактивный режим редактирования соединения.
    *   `nmcli connection show` — показать все сетевые соединения.
    *   `nmcli connection modify "eth0" ipv4.dns "8.8.8.8"` — установить DNS-сервер.

19. **Что такое SELinux?**
    SELinux (Security-Enhanced Linux) — это механизм принудительного контроля доступа, который обеспечивает дополнительную безопасность, разграничивая доступ процессов и пользователей к объектам (файлам, сокетам и т.д.) на основе политик.

20. **Что такое контекст (метка) SELinux?**
    Контекст (метка) SELinux — это специальный атрибут (например, `system_u:object_r:named_zone_t:s0`), присваиваемый каждому процессу и файлу в системе. SELinux использует эти метки для принятия решений о разрешении или запрете операций.

21. **Как восстановить контекст SELinux после внесения изменений в конфигурационные файлы?**
    Для восстановления контекста используется команда `restorecon`:
    *   `restorecon -vR /etc/named` — рекурсивно восстановить контекст для каталога `/etc/named`.

22. **Как создать разрешающие правила политики SELinux из файлов журналов, содержащих сообщения о запрете операций?**
    Для генерации правил на основе записей в логах используется утилита `audit2allow`.

23. **Что такое булевый переключатель в SELinux?**
    Булевый переключатель (boolean) в SELinux — это параметр, который позволяет динамически изменять поведение политики безопасности без её перекомпиляции. Например, `named_write_master_zones` разрешает демону `named` запись в мастер-зоны.

24. **Как посмотреть список переключателей SELinux и их состояние?**
    Для просмотра списка и состояния переключателей используется команда:
    *   `getsebool -a | grep named`

25. **Как изменить значение переключателя SELinux?**
    Для изменения значения переключателя используется команда `setsebool`:
    *   `setsebool -P named_write_master_zones 1` — установить переключатель в значение 1 (включить) с сохранением (`-P`) после перезагрузки.

# Список литературы{.unnumbered}

1. Barr D. Common DNS Operational and Configuration Errors: RFC / RFC Editor. —
02/1996. — DOI: 10.17487/rfc1912.
2. Security-Enhanced Linux. Linux с улучшенной безопасностью: руководство пользователя / M. McAllister, S. Radvan, D. Walsh, D. Grift, E. Paris, J. Morris. — URL: https:
//docs-old.fedoraproject.org/ru-RU/Fedora/13/html/Security-Enhanced_Linux/
index.html (дата обр. 13.09.2021).
3. Systemd. — 2015. — URL: https://wiki.archlinux.org/index.php/Systemd (visited
on 09/13/2021).
4. Костромин В. А. Утилита lsof — инструмент администратора. — URL: http : / / rus -
linux.net/kos.php?name=/papers/lsof/lsof.html (дата обр. 13.09.2021).
5. Поттеринг Л. Systemd для администраторов: цикл статей. — 2010. — URL: http :
//wiki.opennet.ru/Systemd (дата обр. 13.09.2021).
6. Сайт проекта NetworkManager. — URL: https : / / wiki . gnome . org / Projects /
NetworkManager (visited on 09/13/2021).
7. Сайт проекта nmcli. — URL: https://developer.gnome.org/NetworkManager/stable/
nmcli.html (visited on 09/13/2021).

::: {#refs}
:::
